'use strict';

/**
 * Module dependencies
 */

module.exports = mongoose => {
  require('mongoose-float').loadType(mongoose);

  const SchemaTypes = mongoose.Schema.Types;

  /**
   * Since we don't want to use decimals for the time being... we can just reimplement the trivial decimal handler...
   *
   * case 'decimal':
   *   return 'Float';
   *
   * would cause string expectations. Now it gets a string and is quite happy. Don't use decimals until this is properly addressed.
   */

  SchemaTypes.Decimal.prototype.cast = function (value) {
    // Note: The decimal format isn't well supported by MongoDB.
    return value.toString(); // It's recommended to use Float or Number type instead.
  };

  return {
    convertType: mongooseType => {
      switch (mongooseType.toLowerCase()) {
        case 'array':
          return Array;
        case 'boolean':
          return 'Boolean';
        case 'binary':
          return 'Buffer';
        case 'date':
        case 'datetime':
        case 'time':
        case 'timestamp':
          return Date;
        case 'decimal':
          return 'Decimal';
        case 'float':
          return 'Float';
        case 'json':
          return 'Mixed';
        case 'biginteger':
        case 'integer':
          return 'Number';
        case 'uuid':
          return 'ObjectId';
        case 'email':
        case 'enumeration':
        case 'password':
        case 'string':
        case 'text':
          return 'String';
        default:
      }
    },
  };
};
